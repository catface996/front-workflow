# 阶段四：还原校验

> 交付前的最后把关：像素级对比、多端测试、与设计沟通

---

## 4.1 像素级对比

### 方法一：浏览器插件叠加

使用 PerfectPixel 等插件：

1. 从设计稿导出对应页面截图
2. 在插件中加载截图
3. 调整透明度叠加对比
4. 标记偏差位置

### 方法二：截图Diff工具

```bash
# 使用 pixelmatch 进行自动对比
npx pixelmatch design.png screenshot.png diff.png 0.1
```

### 方法三：设计工具对比

在Figma/Sketch中直接叠加截图与设计稿对比

### 容差标准

| 偏差类型 | 可接受范围 |
|---------|-----------|
| 间距偏差 | ±2px |
| 字号偏差 | 0px（必须准确）|
| 颜色偏差 | 0（必须准确）|
| 圆角偏差 | ±1px |
| 对齐偏差 | 0px（必须准确）|

---

## 4.2 多端测试

### 浏览器测试清单

| 浏览器 | 版本 | 状态 |
|--------|------|------|
| Chrome | 最新版 | ⏳ |
| Firefox | 最新版 | ⏳ |
| Safari | 最新版 | ⏳ |
| Edge | 最新版 | ⏳ |

### 移动端测试清单

| 设备 | 系统 | 浏览器 | 状态 |
|------|------|--------|------|
| iPhone | iOS 16+ | Safari | ⏳ |
| iPhone | iOS 16+ | Chrome | ⏳ |
| Android | Android 12+ | Chrome | ⏳ |
| iPad | iPadOS | Safari | ⏳ |

### 响应式断点测试

| 断点 | 宽度范围 | 测试设备/模拟 | 状态 |
|------|---------|--------------|------|
| XS | <640px | iPhone SE (375px) | ⏳ |
| SM | 640-767px | iPhone 14 Pro (393px) | ⏳ |
| MD | 768-1023px | iPad Mini (768px) | ⏳ |
| LG | 1024-1279px | iPad Pro (1024px) | ⏳ |
| XL | ≥1280px | Desktop (1920px) | ⏳ |

---

## 4.3 检查清单

### 布局还原检查

```
[ ] 主要区块位置与设计稿一致
[ ] 间距符合设计规范（容差 ±2px）
[ ] 元素对齐正确（左/居中/右）
[ ] 层级关系正确（z-index）
[ ] 固定/吸顶元素行为正确
[ ] 滚动行为正确
```

### 视觉还原检查

```
[ ] 颜色值准确（使用设计系统变量）
[ ] 字体/字号/行高正确
[ ] 字重正确（regular/medium/semibold/bold）
[ ] 圆角值正确
[ ] 阴影效果正确
[ ] 边框样式正确
[ ] 图标尺寸和颜色正确
[ ] 图片比例和裁剪正确
```

### 组件一致性检查

```
[ ] 相同组件在各处样式统一
[ ] 组件使用设计系统变量
[ ] 无硬编码的魔法数字
[ ] 组件状态完整（hover/active/focus/disabled）
[ ] 组件变体完整
```

### 响应式检查

```
[ ] 各断点布局正确
[ ] 断点切换过渡自然
[ ] 移动端触摸目标足够大（≥44px）
[ ] 移动端无横向滚动条
[ ] 字体在各设备上可读
[ ] 图片在各设备上显示正常
```

### 无障碍检查

```
[ ] 图片有alt属性
[ ] 表单元素有label
[ ] 颜色对比度达标（WCAG AA 4.5:1）
[ ] 可键盘导航
[ ] focus状态可见
[ ] 语义化HTML结构
```

### 性能检查

```
[ ] 图片已优化（WebP/压缩）
[ ] 无大体积未压缩资源
[ ] CSS无复杂选择器
[ ] 无不必要的动画
[ ] 首屏加载合理
```

### 代码质量检查

```
[ ] 移除所有debug样式和标注
[ ] 移除console.log调试语句
[ ] 移除所有data-debug属性
[ ] CSS无冗余/未使用的选择器
[ ] 响应式代码有序组织
[ ] 无内联样式（特殊情况除外）
[ ] 类名语义清晰
[ ] 特殊处理有注释说明
```

---

## 4.4 与设计师沟通

### 对齐会议议程

**会前准备**：
- [ ] 部署预览环境
- [ ] 准备各断点截图
- [ ] 整理待确认问题
- [ ] 标注偏差位置

**会议流程**：

1. **整体走查**（5分钟）
   - 展示各页面整体效果
   - 切换不同断点演示

2. **细节对比**（15分钟）
   - 逐页面对比设计稿
   - 标记偏差位置
   - 记录修改建议

3. **问题讨论**（10分钟）
   - 讨论待确认问题
   - 确定偏差是否需要修正
   - 记录设计师反馈

4. **后续计划**（5分钟）
   - 确定修改优先级
   - 约定复查时间

### 会议记录模板

```markdown
## 设计还原对齐记录

**日期**：YYYY-MM-DD
**参与人**：前端开发、UI设计师

### ✅ 确认通过
- 首页整体布局
- 卡片组件样式
- ...

### 🔧 需修改
| 位置 | 问题 | 优先级 |
|------|------|--------|
| Header | Logo间距偏大4px | P1 |
| 列表页 | 卡片阴影偏深 | P2 |

### 📌 保留偏差（设计师确认）
| 位置 | 偏差 | 原因 |
|------|------|------|
| 按钮圆角 | 8px而非6px | 统一设计系统 |

### 📅 下次复查
YYYY-MM-DD HH:mm
```

---

## 4.5 上线前最终检查

```
┌─────────────────────────────────────────────────────────────┐
│                    上线前最终检查                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  🔒 安全检查                                                 │
│  [ ] 无敏感信息硬编码                                        │
│  [ ] API地址配置正确                                         │
│  [ ] 无测试数据残留                                          │
│                                                             │
│  🧹 清理检查                                                 │
│  [ ] 移除 debug.css 引用                                     │
│  [ ] 移除 debug-mode.js 引用                                 │
│  [ ] 移除所有 data-debug 属性                                │
│  [ ] 移除 console 语句                                       │
│  [ ] 移除 TODO 注释（或转为Issue）                           │
│                                                             │
│  📦 构建检查                                                 │
│  [ ] 构建无报错                                              │
│  [ ] 构建产物体积合理                                        │
│  [ ] 资源路径正确                                            │
│  [ ] 静态资源已上传CDN（如需要）                             │
│                                                             │
│  🌐 兼容性检查                                               │
│  [ ] Chrome ✓                                                │
│  [ ] Firefox ✓                                               │
│  [ ] Safari ✓                                                │
│  [ ] Edge ✓                                                  │
│  [ ] iOS Safari ✓                                            │
│  [ ] Android Chrome ✓                                        │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 4.6 交付物清单

| 交付物 | 说明 | 状态 |
|--------|------|------|
| 源代码 | 完整的前端代码 | ⏳ |
| 构建产物 | 打包后的静态资源 | ⏳ |
| 设计系统文件 | CSS变量/主题配置 | ⏳ |
| 偏差说明 | 与设计稿的偏差及原因 | ⏳ |
| 部署说明 | 部署步骤和注意事项 | ⏳ |

---

**工作流完成** 🎉

返回 [README](./README.md) 查看完整工作流概览
