# 阶段一：分析

> 不要一上来就写代码，先理解再动手

---

## 本阶段内容分类

| 章节 | 类型 | 频率 | 说明 |
|------|------|------|------|
| 1.1 组件库检查与确认 | 🏗️ 项目级 | 一次性 | 项目初始化时确认，后续迭代跳过 |
| 1.2 设计稿整体审视 | 🔄 迭代级 | 每次迭代 | 每次拿到设计稿都做 |
| 1.3 组件拆分与映射 | 🔄 迭代级 | 每次迭代 | 每次拿到设计稿都做 |
| 1.4 标注提取 | 🔄 迭代级 | 每次迭代 | 每次拿到设计稿都做 |
| 1.5 资源导出 | 🔄 迭代级 | 每次迭代 | 每次拿到设计稿都做 |

---
---

# 🏗️ 项目级（一次性）

> 项目初始化时执行一次，后续迭代可跳过

---

## 1.1 组件库检查与确认

### 🎯 检查现有组件库

**在拆分组件之前，必须先确认项目的组件库情况！**

#### 检查项目依赖

```bash
# 检查 package.json 中的组件库依赖
cat package.json | grep -E "antd|@ant-design|element|@element-plus|@mui|@chakra-ui|naive-ui|arco-design"
```

#### 常见组件库识别

| 组件库 | 包名 | 适用框架 |
|--------|------|---------|
| Ant Design | `antd`, `@ant-design/icons` | React |
| Ant Design Vue | `ant-design-vue` | Vue |
| Element Plus | `element-plus` | Vue 3 |
| Element UI | `element-ui` | Vue 2 |
| Material UI | `@mui/material` | React |
| Chakra UI | `@chakra-ui/react` | React |
| Naive UI | `naive-ui` | Vue 3 |
| Arco Design | `@arco-design/web-react` | React |
| Arco Design Vue | `@arco-design/web-vue` | Vue |
| TDesign | `tdesign-react`, `tdesign-vue-next` | React/Vue |

#### 确认清单

```
┌─────────────────────────────────────────────────────────────┐
│  组件库检查                                                  │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  项目是否已引入组件库？                                       │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ✅ 已有组件库 → 展示并确认                            │   │
│  │                                                     │   │
│  │   检测到项目已引入:                                   │   │
│  │   • 组件库名称: _______________                      │   │
│  │   • 组件库版本: _______________                      │   │
│  │   • 文档地址: _______________                        │   │
│  │                                                     │   │
│  │   ⚠️ 请确认:                                         │   │
│  │   [ ] 确认使用此组件库                                │   │
│  │   [ ] 需要更换为其他组件库: _______________           │   │
│  │   [ ] 需要同时引入其他组件库: _______________         │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ❌ 未检测到组件库 → 要求用户选择                       │   │
│  │                                                     │   │
│  │   请选择要使用的组件库:                               │   │
│  │   [ ] Ant Design (https://ant.design)               │   │
│  │   [ ] Element Plus (https://element-plus.org)       │   │
│  │   [ ] Material UI (https://mui.com)                 │   │
│  │   [ ] Chakra UI (https://chakra-ui.com)             │   │
│  │   [ ] Naive UI (https://naiveui.com)                │   │
│  │   [ ] Arco Design (https://arco.design)             │   │
│  │   [ ] 其他: _______________                          │   │
│  │   [ ] 不使用组件库，完全自定义                        │   │
│  │                                                     │   │
│  │   ⚠️ 必须选择后才能继续！                             │   │
│  │                                                     │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 确认会话示例

**情况一：已有组件库**
```
📦 组件库检测结果

检测到项目已引入组件库:
• 名称: Ant Design
• 版本: 5.12.8
• 图标库: @ant-design/icons 5.2.6
• 文档: https://ant.design

请确认:
1. 继续使用 Ant Design？
2. 是否需要引入其他辅助库（如图表库）？

---
请回复确认，或指出需要调整的地方。
```

**情况二：未检测到组件库**
```
📦 组件库检测结果

未检测到项目中的组件库依赖。

请选择要使用的组件库:
1. Ant Design (React) - https://ant.design
2. Element Plus (Vue 3) - https://element-plus.org
3. Material UI (React) - https://mui.com
4. 其他（请提供名称和文档地址）
5. 不使用组件库，完全自定义

---
请回复选择的组件库编号，或提供其他组件库信息。
```

---
---

# 🔄 迭代级（每次迭代）

> 每次拿到新设计稿时执行

---

## 1.2 设计稿整体审视

### 页面结构识别

拿到设计稿后，首先识别页面的整体结构：

```
┌─────────────────────────────────────────────────────────┐
│  Header          [固定/吸顶?]                            │
├─────────────────────────────────────────────────────────┤
│  Sidebar │       Main Content                           │
│  [定宽?] │  [自适应? 最大宽度?]                          │
│  [折叠?] │                                              │
├─────────────────────────────────────────────────────────┤
│  Footer          [跟随内容/固定底部?]                    │
└─────────────────────────────────────────────────────────┘
```

### 布局方式判断

| 区域 | 常见布局方式 | 需确认 |
|------|-------------|--------|
| Header | Flex水平排列 | 是否吸顶、高度 |
| Sidebar | Fixed/Sticky定位 | 宽度、是否可折叠 |
| Main | Flex-grow自适应 | 最大宽度、边距 |
| Footer | 跟随内容 | 是否固定底部 |

### 交互逻辑梳理

- [ ] 哪些元素可点击？
- [ ] 是否有展开/折叠交互？
- [ ] 是否有Tab切换？
- [ ] 是否有弹窗/抽屉？
- [ ] 是否有动画/过渡？

---

## 1.3 组件拆分与映射

### 🎯 第一步：识别设计稿中的组件

从设计稿中识别所有UI组件：

| 设计稿中的元素 | 组件类型 | 出现次数 | 变体 |
|--------------|---------|---------|------|
| 蓝色填充按钮 | Button | 12 | primary |
| 灰色边框按钮 | Button | 8 | outline |
| 输入框 | Input | 15 | text |
| 下拉选择 | Select | 6 | single |
| 带图卡片 | Card | 9 | with-image |
| 数据表格 | Table | 3 | - |
| 分页器 | Pagination | 3 | - |
| 弹窗 | Modal | 2 | confirm |
| ... | ... | ... | ... |

---

### 🎯 第三步：组件映射

**将设计稿组件映射到组件库组件，标注映射状态，并给出二次封装建议**

#### 映射关系表（示例：Ant Design）

| 设计稿组件 | 组件库组件 | 映射状态 | 出现次数 | 二次封装 | 备注 |
|-----------|-----------|---------|---------|---------|------|
| 主按钮 | `<Button type="primary">` | ✅ 匹配 | 12 | 否 | 直接使用 |
| 次按钮 | `<Button>` | ✅ 匹配 | 8 | 否 | 直接使用 |
| 确认弹窗 | `<Modal>` | ✅ 匹配 | 6 | **是** | 统一确认弹窗样式 |
| 删除确认弹窗 | `<Modal>` | ✅ 匹配 | 4 | **是** | 统一危险操作确认 |
| 搜索输入框 | `<Input.Search>` | ✅ 匹配 | 5 | **是** | 统一搜索框样式和行为 |
| 数据表格 | `<Table>` | ✅ 匹配 | 8 | **是** | 统一表格配置 |
| 分页 | `<Pagination>` | ✅ 匹配 | 8 | 否 | 随Table使用 |
| 用户头像 | `<Avatar>` | ✅ 匹配 | 15 | **是** | 统一头像尺寸和fallback |
| 状态标签 | `<Tag>` | ✅ 匹配 | 20 | **是** | 统一状态颜色映射 |
| 带图卡片 | `<Card>` | ⚠️ 定制 | 9 | **是** | 封装ProductCard |
| 统计卡片 | 无 | ❌ 自定义 | 4 | **是** | 新建StatCard |
| 环形图表 | 无 | ❌ 自定义 | 2 | **是** | 基于ECharts封装 |

#### 映射状态说明

| 状态 | 含义 | 处理方式 |
|------|------|---------|
| ✅ 完全匹配 | 组件库有对应组件，可直接使用 | 直接使用，可能需调整样式 |
| ⚠️ 需定制 | 组件库有类似组件，需要定制 | 基于组件库组件扩展 |
| ❌ 需自定义 | 组件库无对应组件 | 完全自定义开发 |
| ❓ 待确认 | 不确定如何映射 | **必须与用户确认** |

---

#### 🔄 二次封装建议

**什么情况下建议二次封装？**

```
┌─────────────────────────────────────────────────────────────┐
│  二次封装判断标准                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ✅ 建议封装的情况:                                          │
│                                                             │
│  1. 多页面复用 (出现次数 ≥ 3)                                 │
│     └── 相同组件在多个页面使用，且配置/样式相同               │
│                                                             │
│  2. 固定配置组合                                             │
│     └── 每次使用都需要传入相同的props组合                    │
│     └── 例: Table总是配置相同的分页、空状态、loading样式      │
│                                                             │
│  3. 业务语义明确                                             │
│     └── 有明确的业务含义，而非纯UI                           │
│     └── 例: UserAvatar, StatusTag, ConfirmModal             │
│                                                             │
│  4. 样式定制较多                                             │
│     └── 需要覆盖组件库默认样式                               │
│     └── 封装后避免样式代码重复                               │
│                                                             │
│  5. 包含业务逻辑                                             │
│     └── 组件内部有通用的业务处理逻辑                         │
│     └── 例: SearchInput自带防抖、ConfirmModal自带loading     │
│                                                             │
│  ─────────────────────────────────────────────────────────  │
│                                                             │
│  ❌ 不建议封装的情况:                                        │
│                                                             │
│  1. 仅使用1-2次                                              │
│  2. 每次使用配置都不同                                       │
│  3. 过度封装会增加理解成本                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 二次封装清单

| 封装组件名 | 基于 | 封装原因 | 封装内容 | 优先级 |
|-----------|------|---------|---------|-------|
| `<ConfirmModal>` | Modal | 6处使用，统一样式 | 固定标题格式、按钮文案、图标 | P1 |
| `<DeleteConfirmModal>` | Modal | 4处使用，危险操作 | 红色警告样式、二次确认逻辑 | P1 |
| `<SearchInput>` | Input.Search | 5处使用 | 统一placeholder、防抖300ms、清空按钮 | P1 |
| `<DataTable>` | Table | 8处使用 | 统一分页配置、空状态、loading | P1 |
| `<UserAvatar>` | Avatar | 15处使用 | 统一尺寸(sm/md/lg)、fallback显示 | P1 |
| `<StatusTag>` | Tag | 20处使用 | 状态-颜色映射(success/warning/error) | P1 |
| `<ProductCard>` | Card | 9处使用 | 封面图布局、标题截断、价格显示 | P2 |
| `<StatCard>` | 自定义 | 4处使用 | 数字+标题+趋势箭头 | P2 |
| `<RingChart>` | ECharts | 2处使用 | 环形图通用配置 | P3 |

#### 封装示例

```jsx
// ❌ 不封装：每个页面重复写配置
<Modal
  title={<><ExclamationCircleOutlined /> 确认删除</>}
  okText="删除"
  cancelText="取消"
  okButtonProps={{ danger: true }}
  onOk={handleDelete}
>
  确定要删除这条记录吗？此操作不可恢复。
</Modal>

// ✅ 封装后：简洁且一致
<DeleteConfirmModal
  onConfirm={handleDelete}
  itemName="这条记录"
/>
```

```jsx
// ❌ 不封装：每个页面重复写
<Table
  loading={loading}
  dataSource={data}
  pagination={{
    current: page,
    pageSize: 10,
    total: total,
    showSizeChanger: true,
    showQuickJumper: true,
    showTotal: (total) => `共 ${total} 条`,
  }}
  locale={{ emptyText: <Empty description="暂无数据" /> }}
/>

// ✅ 封装后：统一配置
<DataTable
  loading={loading}
  dataSource={data}
  pagination={{ current: page, total }}
  columns={columns}
/>
```

---

### 🎯 第四步：与用户确认映射关系

**⚠️ 重要：以下情况必须与用户/团队确认！**

#### 需确认清单

```
┌─────────────────────────────────────────────────────────────┐
│  组件映射确认                                                │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ✅ 完全匹配的组件（共 XX 个）                                │
│  └── 确认是否可以直接使用？ [ ] 是 [ ] 否                     │
│                                                             │
│  ⚠️ 需要定制的组件（共 XX 个）                                │
│  ├── 组件1: __________ → 基于 __________ 定制                │
│  │   定制内容: __________                                   │
│  │   [ ] 确认此方案                                         │
│  │                                                         │
│  ├── 组件2: __________ → 基于 __________ 定制                │
│  │   定制内容: __________                                   │
│  │   [ ] 确认此方案                                         │
│  │                                                         │
│  └── ...                                                    │
│                                                             │
│  ❌ 需要自定义的组件（共 XX 个）                               │
│  ├── 组件1: __________                                      │
│  │   建议方案: __________                                   │
│  │   [ ] 确认此方案                                         │
│  │                                                         │
│  └── ...                                                    │
│                                                             │
│  ❓ 不确定的组件（共 XX 个）- 必须确认！                       │
│  ├── 组件1: __________                                      │
│  │   问题: __________                                       │
│  │   选项A: __________                                      │
│  │   选项B: __________                                      │
│  │   [ ] 选择: __________                                   │
│  │                                                         │
│  └── ...                                                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 确认会话示例

```
📋 组件映射确认

已识别设计稿中 25 个组件，映射情况如下：

✅ 完全匹配：18 个
   Button, Input, Select, Checkbox, Switch, Table,
   Pagination, Modal, Drawer, Tabs, Breadcrumb...

⚠️ 需要定制：4 个
   1. 带图卡片 → 基于 Card 定制，需自定义封面图布局
   2. 用户头像组 → 基于 Avatar.Group 定制，需调整重叠样式
   3. 状态标签 → 基于 Tag 定制，需添加自定义颜色
   4. 步骤条 → 基于 Steps 定制，需自定义图标

❌ 需要自定义：2 个
   1. 统计数字卡片 - 组件库无此组件，建议自定义
   2. 环形进度图 - 建议使用 ECharts 或 AntV

❓ 待确认：1 个
   1. 顶部搜索栏
      - 设计稿样式与 Input.Search 差异较大
      - 选项A: 使用 Input.Search + 样式覆盖
      - 选项B: 完全自定义 SearchBar 组件
      请确认使用哪个方案？

---
请确认以上映射关系，或指出需要调整的地方。
```

---

### 🎯 第五步：输出最终组件清单

确认后，输出最终的组件使用清单：

```markdown
## 组件清单

### 项目信息
- 组件库: Ant Design v5.x
- 文档: https://ant.design

### 组件使用计划

| 组件 | 来源 | 使用方式 | 确认 |
|------|------|---------|------|
| Button | antd | 直接使用 | ✅ |
| Input | antd | 直接使用 | ✅ |
| Select | antd | 直接使用 | ✅ |
| Table | antd | 直接使用 | ✅ |
| Modal | antd | 直接使用 | ✅ |
| Card | antd | 定制封面布局 | ✅ |
| Avatar.Group | antd | 定制重叠样式 | ✅ |
| Tag | antd | 定制颜色变体 | ✅ |
| StatCard | 自定义 | 新建组件 | ✅ |
| RingChart | ECharts | 引入图表库 | ✅ |
| SearchBar | 自定义 | 新建组件 | ✅ |

### 自定义组件开发计划

| 组件名 | 设计稿位置 | 复杂度 | 优先级 |
|--------|-----------|-------|-------|
| StatCard | 首页-数据概览 | 低 | P1 |
| SearchBar | 全局-顶部导航 | 中 | P1 |
| RingChart | 首页-占比图 | 中 | P2 |
```

---

## 1.3 标注提取

### 颜色系统

从设计稿中提取所有使用的颜色：

```
主色系列:
├── Primary-50:  #eff6ff  (最浅)
├── Primary-100: #dbeafe
├── Primary-500: #3b82f6  (主色)
├── Primary-600: #2563eb  (hover)
└── Primary-700: #1d4ed8  (active)

中性色系列:
├── Gray-50:  #f9fafb  (背景)
├── Gray-100: #f3f4f6  (分割线背景)
├── Gray-500: #6b7280  (次要文字)
└── Gray-900: #111827  (主要文字)

语义色:
├── Success: #10b981
├── Warning: #f59e0b
└── Error:   #ef4444
```

### 字体规范

| 用途 | 字号 | 字重 | 行高 |
|------|------|------|------|
| H1标题 | 32px | Bold(700) | 1.2 |
| H2标题 | 24px | Semibold(600) | 1.3 |
| H3标题 | 20px | Semibold(600) | 1.4 |
| 正文 | 16px | Regular(400) | 1.5 |
| 辅助文字 | 14px | Regular(400) | 1.5 |
| 小字 | 12px | Regular(400) | 1.5 |

### 间距规范

基于8px网格系统：

| 变量名 | 值 | 常见用途 |
|--------|-----|---------|
| space-1 | 4px | 紧凑间距 |
| space-2 | 8px | 元素内间距 |
| space-3 | 12px | 小间距 |
| space-4 | 16px | 常规间距 |
| space-6 | 24px | 区块间距 |
| space-8 | 32px | 大间距 |

### 与组件库主题对比

**⚠️ 检查设计稿规范与组件库默认主题的差异**

| 属性 | 设计稿 | 组件库默认 | 是否需要覆盖 |
|------|--------|-----------|-------------|
| 主色 | #3b82f6 | #1677ff | 是 |
| 圆角 | 8px | 6px | 是 |
| 字体 | 16px | 14px | 是 |
| 行高 | 1.5 | 1.5714 | 否 |

---

## 1.4 资源导出

### 导出清单

| 资源类型 | 格式要求 | 命名规范 | 状态 |
|---------|---------|---------|------|
| Logo | SVG | logo.svg / logo-dark.svg | ⏳ |
| 图标 | SVG | icon-{name}.svg | ⏳ |
| 插图 | SVG/PNG | illustration-{name}.svg | ⏳ |
| 背景图 | WebP | bg-{name}.webp | ⏳ |
| 照片 | WebP | photo-{name}.webp | ⏳ |

### 图标处理策略

**先检查组件库是否提供图标：**

| 图标来源 | 优先级 | 说明 |
|---------|-------|------|
| 组件库图标 | 1 | 如 @ant-design/icons |
| 图标库 | 2 | 如 Lucide, Heroicons |
| 设计稿导出 | 3 | 组件库/图标库都没有时 |

```
图标映射示例（Ant Design Icons）:

设计稿图标 → 组件库图标
├── 搜索图标 → SearchOutlined ✅
├── 用户图标 → UserOutlined ✅
├── 设置图标 → SettingOutlined ✅
├── 自定义图标A → 无，需导出 ❌
└── 自定义图标B → 无，需导出 ❌
```

---

## 1.5 分析阶段确认清单

完成以下确认后，进入规划阶段：

| 确认项 | 状态 |
|--------|------|
| 页面整体结构已理解 | ⏳ |
| 布局方式已明确 | ⏳ |
| 交互逻辑已梳理 | ⏳ |
| **组件库已确认** | ⏳ |
| **组件映射已完成** | ⏳ |
| **映射关系已与用户确认** | ⏳ |
| 颜色系统已提取 | ⏳ |
| 字体规范已提取 | ⏳ |
| 间距规范已提取 | ⏳ |
| 资源清单已整理 | ⏳ |
| 资源已导出 | ⏳ |

---

**下一步**：进入 [阶段二：技术规划](./02-planning.md)
